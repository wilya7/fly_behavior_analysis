# TODO: Behavioral Annotation Data Conversion Project Checklist

This checklist outlines all the tasks required to complete the project. Each item is broken down into sub-tasks where necessary. Check items off as you complete them.

---

## 1. Project Setup & Environment
- [x] **Project Initialization**
  - [x] Create a new project folder.
  - [x] Initialize a version control repository (e.g., Git).
  - [x] Create a README.md with project overview and setup instructions.
- [x] **Python Environment**
  - [x] Set up a Conda environment or virtual environment.
  - [x] Create a `environment.yml` and `requirements.txt` listing all dependencies:
    - Pandas
    - NumPy
    - Matplotlib
    - argparse
    - PyTest
- [x] **Folder Structure**
  - [x] Create a main script file (`main.py`).
  - [x] Create a `tests/` folder for unit and integration tests.
  - [x] Create an output folder template (to be generated by the script).

---

## 2. CLI Interface & Argument Parsing
- [ ] **CLI Setup**
  - [x] Use `argparse` to implement command-line argument parsing.
  - [x] Define required arguments:
    - `--input`: Input file or directory.
    - `--output`: Output directory.
  - [x] Define optional argument:
    - `--total_frames`: Total frame count (default: 8999).
- [x] **Output Folder Check**
  - [x] If the output folder already exists, exit with an error message.
- [x] **Status Messages**
  - [x] Print a startup status message (e.g., "Starting processing...").

---

## 3. Input CSV Processing & Validation
- [x] **CSV File Reading**
  - [x] Implement a function to read the CSV file using Pandas.
- [x] **Frame Column Extraction**
  - [x] Validate the presence of the `Frame` column.
  - [x] Convert `Frame` values to integers.
- [x] **Data Validation**
  - [x] Check that the number of frame entries is even.
  - [x] Verify that frame numbers are strictly increasing.
  - [x] Handle errors (missing column, odd count, non-increasing order) appropriately:
    - Log errors or raise exceptions as needed.
- [x] **Unit Tests for CSV Processing**
  - [x] Write tests for valid input CSV.
  - [x] Write tests for CSV with missing `Frame` column.
  - [x] Write tests for odd number of entries.
  - [x] Write tests for non-increasing frame values.

---

## 4. Event Pairing & Timeline Table Generation
- [ ] **Event Pairing Function**
  - [ ] Implement pairing of frame values as alternating start and stop events.
  - [ ] Validate each pair: start frame â‰¤ stop frame.
- [ ] **Timeline Table Creation**
  - [ ] Create a Pandas DataFrame for frames 1 to N.
  - [ ] Initialize columns:
    - `Frame`
    - `GroomingFlag` (default 0)
    - `EventID` (default 0)
  - [ ] For each event pair:
    - [ ] Update rows from start to stop with `GroomingFlag = 1`.
    - [ ] Assign a unique positive `EventID` for each event.
- [ ] **Unit Tests for Timeline Generation**
  - [ ] Verify timeline DataFrame correctness given sample input frames.

---

## 5. Event List Generation
- [ ] **Event List Function**
  - [ ] Implement a function to generate an event list from paired events.
  - [ ] Create a DataFrame (or CSV) with columns:
    - `EventID`
    - `StartFrame`
    - `StopFrame`
- [ ] **Unit Tests for Event List**
  - [ ] Verify that the event list matches expected events for given inputs.

---

## 6. Visualization Functions
- [ ] **Timeline Plot Function**
  - [ ] Create a function to generate a timeline plot as a PNG.
  - [ ] The plot should color-code grooming regions along frames 1 to N.
- [ ] **Box Plot Function**
  - [ ] Create a function to generate a box plot (PNG) showing the distribution of grooming event durations.
  - [ ] Calculate durations as `StopFrame - StartFrame + 1`.
- [ ] **Unit Tests for Visualizations**
  - [ ] Check that the PNG files are generated.
  - [ ] Optionally verify file non-emptiness or basic plot properties.

---

## 7. Error Logging & Batch Processing
- [ ] **Error Logging Function**
  - [ ] Implement a function to log errors in an `errorLog.csv` file.
  - [ ] Log details: file name, error type, timestamp, and problematic frame (if applicable).
- [ ] **Batch Processing Function**
  - [ ] Create a function to process all CSV files in a specified input directory.
  - [ ] For each file:
    - [ ] Process input CSV and validate.
    - [ ] If errors are found, log the error and skip processing.
    - [ ] If valid, generate outputs:
      - Timeline Table CSV
      - Event List CSV
      - Timeline Plot PNG
      - Box Plot PNG
  - [ ] Track per-file metrics:
    - Number of events
    - Total grooming duration
    - Average/median event duration
    - Percentage of grooming frames
  - [ ] Aggregate overall metrics:
    - Total files processed
    - Number of successfully processed files
    - Number of faulty files
- [ ] **Unit/Integration Tests for Batch Processing**
  - [ ] Simulate a directory with a mix of valid and faulty CSV files.
  - [ ] Verify outputs and error log entries.

---

## 8. Consolidated Summary Report
- [ ] **Summary Report Function**
  - [ ] Generate a consolidated CSV report aggregating per-file and overall metrics.
  - [ ] Include file-specific metrics and overall statistics.
- [ ] **Unit Tests for Summary Report**
  - [ ] Validate that the report accurately reflects the metrics from processed files.

---

## 9. Final Integration & Main Function Wiring
- [ ] **Main Function**
  - [ ] Wire together CLI parsing, file processing, output generation, and error logging.
  - [ ] Distinguish between single file and directory processing.
  - [ ] Call appropriate functions for each processing step.
  - [ ] Print status messages for each file processed.
  - [ ] Print or output the final consolidated summary report.
- [ ] **Integration Testing**
  - [ ] Write an integration test that simulates a full run with sample inputs.
  - [ ] Ensure that all modules work together without orphaned code.

---

## 10. Documentation & Final Checks
- [ ] **Inline Documentation**
  - [ ] Ensure all functions have proper docstrings.
  - [ ] Add inline comments explaining complex sections.
- [ ] **User Documentation**
  - [ ] Update README.md with installation, usage instructions, and example commands.
- [ ] **Code Cleanup**
  - [ ] Remove any orphaned or dead code.
  - [ ] Check for PEP8 compliance and style consistency.
- [ ] **Final Testing**
  - [ ] Run the complete test suite using PyTest.
  - [ ] Manually test CLI execution with various inputs.
  - [ ] Verify that error handling and logging work as expected.

---

This checklist should serve as a comprehensive guide for completing the project step-by-step. Use it to track your progress and ensure all aspects of the project are implemented and tested.
