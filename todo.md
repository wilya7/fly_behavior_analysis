# TODO: Behavioral Annotation Data Conversion Project Checklist

This checklist outlines all the tasks required to complete the project. Each item is broken down into sub-tasks where necessary. Check items off as you complete them.

---

## 1. Project Setup & Environment
- [x] **Project Initialization**
  - [x] Create a new project folder.
  - [x] Initialize a version control repository (e.g., Git).
  - [x] Create a README.md with project overview and setup instructions.
- [x] **Python Environment**
  - [x] Set up a Conda environment or virtual environment.
  - [x] Create a `environment.yml` and `requirements.txt` listing all dependencies:
    - Pandas
    - NumPy
    - Matplotlib
    - argparse
    - PyTest
- [x] **Folder Structure**
  - [x] Create a main script file (`main.py`).
  - [x] Create a `tests/` folder for unit and integration tests.
  - [x] Create an output folder template (to be generated by the script).

---

## 2. CLI Interface & Argument Parsing
- [x] **CLI Setup**
  - [x] Use `argparse` to implement command-line argument parsing.
  - [x] Define required arguments:
    - `--input`: Input file or directory.
    - `--output`: Output directory.
  - [x] Define optional argument:
    - `--total_frames`: Total frame count (default: 8999).
- [x] **Output Folder Check**
  - [x] If the output folder already exists, exit with an error message.
- [x] **Status Messages**
  - [x] Print a startup status message (e.g., "Starting processing...").

---

## 3. Input CSV Processing & Validation
- [x] **CSV File Reading**
  - [x] Implement a function to read the CSV file using Pandas.
- [x] **Frame Column Extraction**
  - [x] Validate the presence of the `Frame` column.
  - [x] Convert `Frame` values to integers.
- [x] **Data Validation**
  - [x] Check that the number of frame entries is even.
  - [x] Verify that frame numbers are strictly increasing.
  - [x] Handle errors (missing column, odd count, non-increasing order) appropriately:
    - Log errors or raise exceptions as needed.
- [x] **Unit Tests for CSV Processing**
  - [x] Write tests for valid input CSV.
  - [x] Write tests for CSV with missing `Frame` column.
  - [x] Write tests for odd number of entries.
  - [x] Write tests for non-increasing frame values.

---

## 4. Event Pairing & Timeline Table Generation
- [x] **Event Pairing Function**
  - [x] Implement pairing of frame values as alternating start and stop events.
  - [x] Validate each pair: start frame â‰¤ stop frame.
- [x] **Timeline Table Creation**
  - [x] Create a Pandas DataFrame for frames 1 to N.
  - [x] Initialize columns:
    - `Frame`
    - `GroomingFlag` (default 0)
    - `EventID` (default 0)
  - [x] For each event pair:
    - [x] Update rows from start to stop with `GroomingFlag = 1`.
    - [x] Assign a unique positive `EventID` for each event.
- [x] **Unit Tests for Timeline Generation**
  - [x] Verify timeline DataFrame correctness given sample input frames.

---

## 5. Event List Generation
- [x] **Event List Function**
  - [x] Implement a function to generate an event list from paired events.
  - [x] Create a DataFrame (or CSV) with columns:
    - `EventID`
    - `StartFrame`
    - `StopFrame`
- [x] **Unit Tests for Event List**
  - [x] Verify that the event list matches expected events for given inputs.

---

## 6. Visualization Functions
- [x] **Timeline Plot Function**
  - [x] Create a function to generate a timeline plot as a PNG.
  - [x] The plot should color-code grooming regions along frames 1 to N.
- [x] **Box Plot Function**
  - [x] Create a function to generate a box plot (PNG) showing the distribution of grooming event durations.
  - [x] Calculate durations as `StopFrame - StartFrame + 1`.
- [x] **Unit Tests for Visualizations**
  - [x] Check that the PNG files are generated.
  - [x] Optionally verify file non-emptiness or basic plot properties.

---

## 7. Error Logging & Batch Processing
- [x] **Error Logging Function**
  - [x] Implement a function to log errors in an `errorLog.csv` file.
  - [x] Log details: file name, error type, timestamp, and problematic frame (if applicable).
- [x] **Batch Processing Function**
  - [x] Create a function to process all CSV files in a specified input directory.
  - [x] For each file:
    - [x] Process input CSV and validate.
    - [x] If errors are found, log the error and skip processing.
    - [x] If valid, generate outputs:
      - Timeline Table CSV
      - Event List CSV
      - Timeline Plot PNG
      - Box Plot PNG
  - [x] Track per-file metrics:
    - Number of events
    - Total grooming duration
    - Average/median event duration
    - Percentage of grooming frames
  - [x] Aggregate overall metrics:
    - Total files processed
    - Number of successfully processed files
    - Number of faulty files
- [x] **Unit/Integration Tests for Batch Processing**
  - [x] Simulate a directory with a mix of valid and faulty CSV files.
  - [x] Verify outputs and error log entries.

---

## 8. Consolidated Summary Report
- [x] **Summary Report Function**
  - [x] Generate a consolidated CSV report aggregating per-file and overall metrics.
  - [x] Include file-specific metrics and overall statistics.
- [x] **Unit Tests for Summary Report**
  - [x] Validate that the report accurately reflects the metrics from processed files.

---

## 9. Final Integration & Main Function Wiring (Redundant)
- [x] **Main Function**
  - [x] Wire together CLI parsing, file processing, output generation, and error logging.
  - [x] Distinguish between single file and directory processing.
  - [x] Call appropriate functions for each processing step.
  - [x] Print status messages for each file processed.
  - [x] Print or output the final consolidated summary report.
- [x] **Integration Testing**
  - [x] Write an integration test that simulates a full run with sample inputs.
  - [x] Ensure that all modules work together without orphaned code.

---

## 10. Documentation & Final Checks (Redundant)
- [x] **Inline Documentation**
  - [x] Ensure all functions have proper docstrings.
  - [x] Add inline comments explaining complex sections.
- [x] **User Documentation**
  - [x] Update README.md with installation, usage instructions, and example commands.
- [x] **Code Cleanup**
  - [x] Remove any orphaned or dead code.
  - [x] Check for PEP8 compliance and style consistency.
- [x] **Final Testing**
  - [x] Run the complete test suite using PyTest.
  - [x] Manually test CLI execution with various inputs.
  - [x] Verify that error handling and logging work as expected.
